# 🚀 Render Deployment Guide - Step by Step

## Prerequisites
- GitHub account
- Render account (free tier available)
- PostgreSQL client (optional, for database management)

## Step 1: Prepare Your Repository

### 1.1 Create GitHub Repository
```bash
# Initialize git repository
git init

# Add all files
git add .

# Commit changes
git commit -m "Initial commit - Mata Group Expense Management"

# Create main branch
git branch -M main

# Add remote origin (replace with your GitHub username)
git remote add origin https://github.com/YOUR_USERNAME/mata-depenses-management.git

# Push to GitHub
git push -u origin main
```

### 1.2 Verify Files
Ensure these files are in your repository:
- ✅ `package.json`
- ✅ `server.js`
- ✅ `database_schema.sql`
- ✅ `render.yaml` (optional)
- ✅ `public/` folder with all frontend files
- ✅ `categories_config.json`
- ✅ `.gitignore`

## Step 2: Create Render Account

1. Go to [render.com](https://render.com)
2. Click "Get Started for Free"
3. Sign up with GitHub account
4. Authorize Render to access your repositories

## Step 3: Create PostgreSQL Database

### 3.1 Create Database Service
1. In Render Dashboard, click **"New +"**
2. Select **"PostgreSQL"**
3. Configure database:
   - **Name**: `mata-depenses-db`
   - **Database**: `depenses_management`
   - **User**: Will be auto-generated by Render
   - **Region**: `Oregon (US West)` or closest to your users
   - **PostgreSQL Version**: `15` (latest)
   - **Plan**: 
     - **Free**: $0/month (limited, good for testing)
     - **Starter**: $7/month (recommended for production)

### 3.2 Note Database Connection Details
After creation, save these details:
- **External Database URL**: `postgresql://username:password@host:port/database`
- **Internal Database URL**: For internal service communication
- **Host**: `dpg-xxxxx-a.oregon-postgres.render.com`
- **Port**: `5432`
- **Database**: `depenses_management`
- **Username**: Auto-generated by Render
- **Password**: Auto-generated secure password

## Step 4: Initialize Database Schema

### 4.1 Connect to Database
Use the External Database URL to connect:

**Option A: Using psql command line**
```bash
psql "postgresql://USERNAME:PASSWORD@HOST:5432/depenses_management"
```

**Option B: Using pgAdmin or other GUI tools**
- Host: Your Render database host
- Port: 5432
- Database: depenses_management
- Username: Your Render database username
- Password: Your database password

### 4.2 Run Database Schema
Copy and paste the entire content of `database_schema.sql` into your PostgreSQL client and execute it.

**Verify installation:**
```sql
-- Check tables were created
\dt

-- Verify users table
SELECT * FROM users;

-- Check if default users exist
SELECT username, role, is_active FROM users;
```

You should see 7 default users created.

## Step 5: Create Web Service

### 5.1 Create Web Service
1. In Render Dashboard, click **"New +"**
2. Select **"Web Service"**
3. Connect your GitHub repository
4. Configure service:
   - **Name**: `mata-depenses-management`
   - **Environment**: `Node`
   - **Region**: Same as your database
   - **Branch**: `main`
   - **Root Directory**: Leave empty (if app is in root)
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`

### 5.2 Configure Environment Variables
Add these environment variables:

| Key | Value | Notes |
|-----|-------|-------|
| `NODE_ENV` | `production` | Sets production mode |
| `PORT` | `10000` | Render's default port |
| `SESSION_SECRET` | `[32-char random string]` | Generate secure key |
| `DB_HOST` | `[Your DB host]` | From Step 3.2 |
| `DB_PORT` | `5432` | PostgreSQL default port |
| `DB_NAME` | `depenses_management` | Database name |
| `DB_USER` | `[Auto-generated]` | Database username from Render |
| `DB_PASSWORD` | `[Your DB password]` | From Step 3.2 |

**Generate SESSION_SECRET:**
```bash
# Generate random 32-character string
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 5.3 Advanced Settings (Optional)
- **Health Check Path**: `/` (default)
- **Auto-Deploy**: `Yes` (deploys on git push)

## Step 6: Deploy Application

### 6.1 Start Deployment
1. Click **"Create Web Service"**
2. Render will automatically:
   - Clone your repository
   - Run `npm install`
   - Start your application with `npm start`

### 6.2 Monitor Deployment
Watch the build logs for:
- ✅ Dependencies installation
- ✅ Application startup
- ✅ Database connection
- ❌ Any errors

**Common build log messages:**
```
==> Cloning from https://github.com/username/repo...
==> Running build command 'npm install'...
==> Starting service with 'npm start'...
==> Server started on port 10000
==> Your service is live 🎉
```

## Step 7: Verify Deployment

### 7.1 Access Application
1. Get your app URL: `https://mata-depenses-management.onrender.com`
2. Open in browser
3. You should see the login page

### 7.2 Test Login
Use default credentials:

| Role | Username | Password |
|------|----------|----------|
| Directeur Général | `Ousmane` | `password123` |
| PCA | `Saliou` | `password123` |
| Directeur | `Mame Diarra` | `password123` |
| Directeur | `Papi` | `password123` |
| Directeur | `Nadou` | `password123` |
| Directeur | `Madieye` | `password123` |
| Directeur | `Babacar` | `password123` |

### 7.3 Test Mobile Responsiveness
1. Open browser developer tools
2. Toggle device simulation
3. Test on various screen sizes:
   - iPhone SE (375x667)
   - iPhone 12 (390x844)
   - iPad (768x1024)
   - Android phones

## Step 8: Post-Deployment Configuration

### 8.1 Update Default Passwords
1. Login as admin (Ousmane or Saliou)
2. Go to "Gérer Utilisateurs"
3. Reset passwords for all default users
4. Create additional users as needed

### 8.2 Configure Accounts
1. Create accounts for directors
2. Set up initial budgets
3. Configure partner accounts if needed

### 8.3 Test Core Features
- ✅ User login/logout
- ✅ Expense creation
- ✅ File upload
- ✅ Account management
- ✅ Dashboard analytics
- ✅ Mobile navigation

## Step 9: Domain Configuration (Optional)

### 9.1 Custom Domain
1. In Render Dashboard, go to your web service
2. Click "Settings" → "Custom Domains"
3. Add your domain (e.g., `expenses.matagroup.com`)
4. Configure DNS records as instructed

### 9.2 SSL Certificate
Render automatically provides SSL certificates for custom domains.

## Step 10: Monitoring and Maintenance

### 10.1 Monitor Application
- **Logs**: Check application logs in Render dashboard
- **Metrics**: Monitor CPU, memory usage
- **Uptime**: Set up status page monitoring

### 10.2 Database Backups
```bash
# Manual backup
pg_dump "postgresql://user:pass@host:port/db" > backup_$(date +%Y%m%d).sql

# Restore backup
psql "postgresql://user:pass@host:port/db" < backup_file.sql
```

### 10.3 Updates
```bash
# Update dependencies
npm update

# Commit and push changes
git add .
git commit -m "Update dependencies"
git push origin main
```

Render will automatically redeploy on git push.

## Troubleshooting

### Common Issues

**1. Database Connection Error**
```
Error: connect ECONNREFUSED
```
**Solution:**
- Verify environment variables
- Check database status in Render
- Ensure database and web service are in same region

**2. Build Failure**
```
npm ERR! missing script: start
```
**Solution:**
- Verify `package.json` has correct scripts
- Check Node.js version compatibility

**3. Session Issues**
```
Error: session secret required
```
**Solution:**
- Set `SESSION_SECRET` environment variable
- Generate secure random string

**4. File Upload Issues**
```
Error: ENOENT: no such file or directory, open './uploads'
```
**Solution:**
- Ensure uploads directory is created in code
- Check file permissions

### Getting Help

1. **Render Documentation**: [render.com/docs](https://render.com/docs)
2. **Application Logs**: Check in Render dashboard
3. **Database Logs**: Monitor PostgreSQL logs
4. **GitHub Issues**: Create issues in your repository

## Security Checklist

- ✅ Change default passwords
- ✅ Use strong SESSION_SECRET
- ✅ Enable HTTPS (automatic with Render)
- ✅ Validate all user inputs
- ✅ Regular database backups
- ✅ Monitor application logs
- ✅ Keep dependencies updated

## Cost Estimation

**Free Tier:**
- Web Service: $0/month (with limitations)
- PostgreSQL: $0/month (limited storage/connections)
- **Total**: $0/month

**Production Tier:**
- Web Service: $7/month (Starter plan)
- PostgreSQL: $7/month (Starter plan)
- **Total**: $14/month

## Success! 🎉

Your Mata Group Expense Management application is now live and accessible worldwide!

**Next Steps:**
1. Share the URL with your team
2. Train users on the mobile interface
3. Set up regular backups
4. Monitor usage and performance

---

**Support**: For technical issues, check the application logs in Render dashboard or review this deployment guide. 